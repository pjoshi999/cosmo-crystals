(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[490],{1588:(e,r,t)=>{"use strict";t.d(r,{default:()=>n,q:()=>i});var a=t(5155),s=t(432),l=t(6715);let i=new s.E({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:3,staleTime:6e4,gcTime:0,throwOnError:!1},mutations:{retry:!1,throwOnError:!0}}});function n(e){let{children:r}=e;return(0,a.jsxs)(l.Ht,{client:i,children:[r,!1]})}},1890:(e,r,t)=>{"use strict";t.d(r,{L:()=>l,z:()=>s});var a=t(5327);let s={all:["cart"],lists:()=>[...s.all,"list"]},l=async()=>{let{data:e}=await a.u.get("/cart/");return e}},4503:(e,r,t)=>{"use strict";t.d(r,{YQ:()=>c,uV:()=>u,DP:()=>d});var a=t(1890),s=t(1588),l=t(5327);let i={addToCart:async e=>l.u.post("/cart",e),updateCart:async e=>l.u.patch("/cart",e),removeFromCart:async e=>l.u.delete("/cart/".concat(e.productId))};var n=t(9945),o=t(1990);let c=(0,o.zD)("cart/addToCart",async(e,r)=>{try{let r=await i.addToCart(e);if(r&&r.data)return s.q.invalidateQueries({queryKey:a.z.lists()}),r.data;throw Error("No data found")}catch(t){let{error:e}=(0,n.h)(t);return r.rejectWithValue(e)}}),d=(0,o.zD)("cart/updateCart",async(e,r)=>{try{let r=await i.updateCart(e);if(r&&r.data)return s.q.invalidateQueries({queryKey:a.z.lists()}),r.data;throw Error("No data found")}catch(t){let{error:e}=(0,n.h)(t);return r.rejectWithValue(e)}}),u=(0,o.zD)("cart/removeFromCart",async(e,r)=>{try{let r=await i.removeFromCart(e);if(r&&r.data)return s.q.invalidateQueries({queryKey:a.z.lists()}),r.data;throw Error("No data found")}catch(t){let{error:e}=(0,n.h)(t);return r.rejectWithValue(e)}}),m=(0,o.Z0)({name:"auth",initialState:{loading:!1,error:null},reducers:{},extraReducers:e=>{e.addCase(c.pending,e=>{e.loading=!0,e.error=null}).addCase(c.fulfilled,e=>{e.error=null,e.loading=!1}).addCase(c.rejected,(e,r)=>{e.error=r.payload,e.loading=!1}),e.addCase(d.pending,e=>{e.loading=!0,e.error=null}).addCase(d.fulfilled,e=>{e.error=null,e.loading=!1}).addCase(d.rejected,(e,r)=>{e.error=r.payload,e.loading=!1}),e.addCase(u.pending,e=>{e.loading=!0,e.error=null}).addCase(u.fulfilled,e=>{e.error=null,e.loading=!1}).addCase(u.rejected,(e,r)=>{e.error=r.payload,e.loading=!1})}}),{}=m.actions;m.reducer},5327:(e,r,t)=>{"use strict";t.d(r,{u:()=>l});var a=t(3464),s=t(7383);let l=a.A.create({baseURL:"https://cosmo-crystals-backend-6.onrender.com/api/v1",headers:{"Content-Type":"application/json"}});l.interceptors.request.use(async e=>{let r=s.A.get("accessToken");return r&&(e.headers.Authorization="Bearer ".concat(r)),e},e=>Promise.reject(e)),l.interceptors.response.use(e=>e,async e=>{var r,t;let a=e.config;if((null===(r=e.response)||void 0===r?void 0:r.status)===401&&(s.A.remove("accessToken"),(null===(t=e.response)||void 0===t?void 0:t.status)===401&&!a._retry)){a._retry=!0;let e=await i();if(e)return a.headers.Authorization="Bearer ".concat(e),l(a)}return Promise.reject(e)});let i=async()=>{try{var e;let r=s.A.get("refreshToken");if(!r)throw Error("No refresh token available");let t=await a.A.post("".concat("https://cosmo-crystals-backend-6.onrender.com/api/v1","/auth/refresh/"),{refreshToken:r}),l=null===(e=t.data)||void 0===e?void 0:e.accessToken;return s.A.set("accessToken",l,{secure:!0}),l}catch(e){return s.A.remove("accessToken"),null}}},7107:(e,r,t)=>{Promise.resolve().then(t.bind(t,7779))},7779:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>f});var a=t(5155),s=t(2115),l=t(6766),i=t(5038),n=t(8126),o=t.n(n),c=t(7809),d=t(9918),u=t(7383),m=t(4416),h=t(5084),x=t(5695);let v=e=>{let{isOpen:r,onClose:t,productName:s,quantity:l,productId:n}=e,o=(0,x.useRouter)();return(0,a.jsx)(h.N,{children:r&&(0,a.jsxs)("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[(0,a.jsx)(i.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black bg-opacity-50",onClick:t}),(0,a.jsxs)(i.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white rounded-xl p-6 w-full max-w-md z-10 shadow-xl relative",children:[(0,a.jsx)("button",{onClick:t,className:"absolute right-4 top-4 text-gray-500 hover:text-gray-800",children:(0,a.jsx)(m.A,{size:20})}),(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("h3",{className:"text-2xl font-bold text-[#B73B45] mb-2",children:"Sign in Required"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Please sign in to add items to your cart"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("button",{onClick:()=>{localStorage.setItem("cartPendingAction",JSON.stringify({action:"addToCart",productName:s,productId:n,quantity:l})),o.push("/login")},className:"w-full bg-[#B73B45] text-white py-3 px-4 rounded-full shadow-md hover:shadow-lg transition-all",children:"Sign In"}),(0,a.jsx)("button",{onClick:()=>{localStorage.setItem("cartPendingAction",JSON.stringify({action:"addToCart",productName:s,productId:n,quantity:l})),o.push("/register")},className:"w-full bg-white border border-[#B73B45] text-[#B73B45] py-3 px-4 rounded-full shadow-md hover:shadow-lg transition-all",children:"Create Account"}),(0,a.jsx)("button",{onClick:t,className:"w-full text-gray-500 py-2",children:"Continue Browsing"})]})]})]})})};var p=t(4503),g=t(9224),y=t(6671);function f(e){var r,t;let{params:n}=e,{slug:m}=(0,s.use)(n),h=(0,g.CU)(),{data:x,isLoading:f}=(0,d.B)(m),[j,w]=(0,s.useState)(0),[N,b]=(0,s.useState)(1),[C,k]=(0,s.useState)(!1),[A,P]=(0,s.useState)(!1);(0,s.useEffect)(()=>{u.A.get("accessToken")?P(!0):P(!1);let e=localStorage.getItem("cartPendingAction");if(e&&A)try{let{action:r}=JSON.parse(e);localStorage.removeItem("cartPendingAction")}catch(e){console.error("Error processing pending cart action",e),localStorage.removeItem("cartPendingAction")}},[A]);let T=async()=>{if(A){let e=await h.dispatch((0,p.YQ)({productId:null==x?void 0:x.id,quantity:N}));p.YQ.fulfilled.match(e)&&y.oR.success("Product added to cart successfully!")}else k(!0)};return f?(0,a.jsx)("div",{className:"min-h-[80vh] bg-[#F7F3F4] flex items-center justify-center",children:"Loading..."}):(0,a.jsxs)("div",{className:"bg-[#F7F3F4] min-h-[80vh]",children:[(0,a.jsxs)(o(),{children:[(0,a.jsx)("title",{children:"".concat(null==x?void 0:x.name," | Cosmo Crystals")}),(0,a.jsx)("meta",{name:"description",content:"".concat(null==x?void 0:x.name," - ").concat(null==x?void 0:x.description.substring(0,150),"...")})]}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto px-4 py-8 md:py-12",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-12",children:[(0,a.jsxs)(i.P.div,{initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{duration:.6}}},className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsx)("div",{className:"flex md:flex-col gap-3 order-2 md:order-1",children:x.images.map((e,r)=>{var t,s;return(0,a.jsx)(i.P.div,{className:"w-20 h-20 border rounded-xl overflow-hidden cursor-pointer ".concat(j===r?"border-[#B73B45] border-2":"border-gray-200"),whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>w(r),children:(0,a.jsxs)("div",{className:"relative w-full h-full",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-white"}),(0,a.jsx)(l.default,{src:null==x?void 0:null===(t=x.images[r])||void 0===t?void 0:t.url,alt:(null==x?void 0:null===(s=x.images[r])||void 0===s?void 0:s.alt)||(null==x?void 0:x.name),fill:!0,className:"object-cover"})]})},e.id)})}),(0,a.jsx)("div",{className:"flex-1 order-1 md:order-2",children:(0,a.jsxs)(i.P.div,{className:"relative h-[400px] md:h-[500px] rounded-xl overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-white"}),(0,a.jsx)(l.default,{src:null==x?void 0:null===(r=x.images[j])||void 0===r?void 0:r.url,alt:(null==x?void 0:null===(t=x.images[j])||void 0===t?void 0:t.alt)||(null==x?void 0:x.name),fill:!0,className:"object-cover"})]},j)})]}),(0,a.jsxs)(i.P.div,{initial:"hidden",animate:"visible",variants:{hidden:{y:50,opacity:0},visible:{y:0,opacity:1,transition:{duration:.6}}},className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-medium text-gray-800 my-2",children:x.name}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("span",{className:"text-3xl font-bold text-[#EA5C6F] flex items-start gap-0.5",children:[(0,a.jsx)("span",{className:"text-sm pt-1",children:"₹"}),x.salePrice]}),x.salePrice<x.price&&(0,a.jsxs)("span",{className:"text-gray-400 line-through",children:["₹",x.price]})]})]}),(0,a.jsxs)("div",{className:"mt-6 flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex border border-gray-300 rounded-md",children:[(0,a.jsx)("button",{className:"text-lg w-10 h-10 flex items-center justify-center text-gray-500 hover:text-[#B73B45]",onClick:()=>b(Math.max(1,N-1)),children:"‒"}),(0,a.jsx)("div",{className:"w-12 h-10 flex items-center justify-center border-x border-gray-300",children:N}),(0,a.jsx)("button",{className:"text-lg w-10 h-10 flex items-center justify-center text-gray-500 hover:text-[#B73B45]",onClick:()=>b(Math.min(x.stock,N+1)),children:"+"})]}),(0,a.jsx)(i.P.button,{className:"flex-1 bg-[#EA5C6F] text-white h-10 px-6 rounded-md font-medium",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:T,children:"Buy Now"}),(0,a.jsx)(i.P.button,{className:"w-10 h-10 flex items-center justify-center border border-gray-200 rounded-md",whileHover:{scale:1.05},whileTap:{scale:.95},onClick:T,children:(0,a.jsx)(c.A,{size:20,className:"text-gray-500"})})]}),(0,a.jsxs)("div",{className:"mt-12",children:[(0,a.jsx)("h2",{className:"text-xl font-medium mb-4",children:"Description"}),(0,a.jsx)("p",{className:"text-gray-600",children:x.description})]})]})]})}),(0,a.jsx)(v,{isOpen:C,onClose:()=>k(!1),productName:(null==x?void 0:x.name)||"",quantity:N,productId:null==x?void 0:x.id})]})}},9224:(e,r,t)=>{"use strict";t.d(r,{CU:()=>s});var a=t(4540);a.wA.withTypes(),a.d4.withTypes();let s=a.Pj.withTypes()},9918:(e,r,t)=>{"use strict";t.d(r,{B:()=>c,Q:()=>o});var a=t(5327);let s={all:["products"],lists:()=>[...s.all,"list"],list:e=>[...s.lists(),{filters:e}],details:()=>[...s.all,"detail"],detail:e=>[...s.details(),e]},l=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{data:r}=await a.u.get("/products",{params:{page:e.page||1,limit:e.limit||20,category:e.category,minPrice:e.minPrice,maxPrice:e.maxPrice,search:e.search}});return r},i=async e=>{let{data:r}=await a.u.get("/products/".concat(e));return r};var n=t(1769);let o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,n.I)({queryKey:s.list(e),queryFn:()=>l(e)})},c=e=>(0,n.I)({queryKey:s.detail(e),queryFn:()=>i(e),enabled:!!e})},9945:(e,r,t)=>{"use strict";t.d(r,{h:()=>s});var a=t(6671);let s=e=>{if(!e.response)return a.oR.error("Network error occurred"),{error:{network:["Network error occurred"]},toastMessage:"Network error occurred"};let{data:r,status:t}=e.response;try{let e={};if("object"==typeof r&&null!==r)return(null==r?void 0:r.detail)&&(e.detail=[null==r?void 0:r.detail]),"string"==typeof(null==r?void 0:r.error)&&a.oR.error(null==r?void 0:r.error),(null==r?void 0:r.message)&&(e.message=[null==r?void 0:r.message]),Array.isArray(null==r?void 0:r.error)&&(null==r||r.error.map(e=>{a.oR.error((null==e?void 0:e.message)||e)})),{error:Array.isArray(null==r?void 0:r.error)?null==r?void 0:r.error.filter(e=>void 0!==e):[null==r?void 0:r.error].filter(e=>void 0!==e),toastMessage:400===t?"Please correct the errors and try again":"An error occurred"}}catch(e){console.error("Error parsing API response:",e)}return{error:{general:["An unexpected error occurred"]},toastMessage:"An unexpected error occurred"}}}},e=>{var r=r=>e(e.s=r);e.O(0,[122,967,766,769,405,38,432,101,441,684,358],()=>r(7107)),_N_E=e.O()}]);